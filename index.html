<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Package Calculator</title>
</head>

<body>
    <link rel="stylesheet" type="text/css" href="style.css" />

    <div id="container">
        <form>

        <!-- TODO: Make an animation of the arrows and change width/depth on click -->
        <div id="flipArrows" style="display: none">
            &#8645;&#x21C5; <!-- up down arrow -->
            &#8693;&#x21F5; <!-- down up arrow -->
        </div>

        <!-- Two seperate windows for package and case/PDQ/Try-Me -->
        <div id="package">
            <canvas id="pkgCanvas">Package Canvas</canvas>

            <table>
                <tr><td></td><td colspan="2" align="center">Package</td></tr>

                <tr>
                <td><div class="legend">
                    <div>Width:</div>
                    <div>Depth:</div>
                    <div>Height:</div>
                    <div>Cube:</div>
                </div></td>
                
                <td><div class="divTable">
                    <div>
                        <input name="pkgW_CM" type="number" placeholder="0.0" 
                               id ="pkgW_CM" class="cell">
                        <span>cm</span>
                        <input name="pkgW_IN" type="number" placeholder="0.0"
                               id="pkgW_IN" class="cell">
                        <span>in</span>
                    </div>

                    <div>
                        <input name="pkgD_CM" type="number" placeholder="0.0"
                               id="pkgD_CM" class="cell">
                        <span>cm</span>
                        <input name="pkgD_IN" type="number" placeholder="0.0"
                               id="pkgD_IN" class="cell">
                        <span>in</span>
                    </div>

                    <div>
                        <input name="pkgH_CM" type="number" placeholder="0.0"
                               id="pkgH_CM" class="cell">
                        <span>cm</span>
                        <input name="pkgH_IN" type="number" placeholder="0.0"
                               id="pkgH_IN" class="cell">
                        <span>in</span>
                    </div>

                    <div>
                        <input name="pkgC_M" type="number" placeholder="0.0" readonly
                               id="pkgC_M" class="noRange noBG">
                        <span>M</span>
                        <input name="pkgC_FT" type="number" placeholder="0.0" readonly
                               id="pkgC_FT" class="noRange noBG">
                        <span>Ft</span>
                    </div>
                </div></td>

                <!-- TODO: let user add a height value option -->

                <!-- Mods: i) +1.5, +1.5, +2; ii) +2, +2, +2.5 -->
                <td><div id="modOpt"class="divTable">
                    <div id="opt1"></div>
                    <div id="opt3"></div>
                    <div id="opt2"></div>
                    <button name="modBtn", onclick="setMod()"
                            id="modBtn" class="gemmyBorder"></button>
                </div>
                </td></tr>

            </table>
        </div>

        <div id="masterCase">
            <canvas id="caseCanvas">Master Case Canvas</canvas>

            <table>
                <tr><td></td>
                <td align="center">
                    Master Case | Qty: 

                    <div id="qtyByCover">
                        <!--<div id="qtyEff"></div>-->
                        <!--<div>TEST</div>-->


                        <!--<input name="qty1" type="number" value="2"
               id="qty1" class="noRange">-->
                        <!-- Multiply sign. Or use: &#215; -->
                        <!--&times;-->
                        <!--<input name="qty2" type="number" value="3"
               id="qty2" class="noRange">-->

                    </div>



                    <!-- User clicks on qty, two hidden inputs will show -->
                    <!--<input name="qtyCover" type="number"
                           id="qtyCover" class=".noRange" readonly/>-->
                    
                </td></tr>

                <tr>
                <td><div class="legend">
                    <div>Width:</div>
                    <div>Depth:</div>
                    <div>Height:</div>
                    <div>Cube:</div>
                </div></td>
                
                <td><div class="divTable">
                    <div>
                        <input class="input" name="masterW_CM" type="number" placeholder="0.0">
                        <span>cm</span>
                        <input name="masterW_IN" type="number" placeholder="0.0">
                        <span>in</span>
                    </div>

                    <div>
                        <input name="masterD_CM" type="number" placeholder="0.0">
                        <span>cm</span>
                        <input name="masterD_IN" type="number" placeholder="0.0">
                        <span>in</span>
                    </div>

                    <div>
                        <input name="masterH_CM" type="number" placeholder="0.0">
                        <span>cm</span>
                        <input name="masterH_IN" type="number" placeholder="0.0">
                        <span>in</span>
                    </div>

                    <div>
                        <input name="masterC_M" type="number" placeholder="0.0" readonly
                               id="masterC_M" class="noRange noBG">
                        <span>M</span>
                        <input name="masterC_FT" type="number" placeholder="0.0" readonly
                               id="masterC_FT" class="noRange noBG">
                        <span>Ft</span>
                    </div>
                </div></td></tr>

        </table></div>
    
        <!-- Save options: as an pop-up excel sheet / screenshot / and a clear button -->
        <div id="options">
            <button type="button" id="saveAsExcelBtn" class="flatbutton">Save As Excel</button>
            <button type="button" id="saveScreenBtn" class="flatbutton">Save Screen to Clipboard</button>
            <button type="reset" class="flatbutton">Clear All</button>
        </div>

    </form></div>

    <!-- jQuery added just in case of downward compatibility -->
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.12.4.min.js"></script>
    <script src="js/Gemmy_validation.js"></script>
    <script>
        var ele; // I dunno, an var specially for temporary document creation.

        // Global canvas variables
        var pkgCanvas = {
            a: document.getElementById('pkgCanvas'),
            c: a.getContext('2d'),
            w: a.width,
            h: a.height
        };
        var mstrCanvas = {
            a: document.getElementById('caseCanvas'),
            c: a.getContext('2d'),
            w: a.width,
            h: a.height
        };

        // Simple objects to store the variables
        var package_CM, package_IN, mCase_CM, mCase_IN;
        var package_CM = {
            width: 0,
            depth: 0,
            height: 0,
            cube: 0
        };

        mCase_IN = mCase_CM = package_IN = package_CM;

        //TEST
        //console.log("RoundToNearest:" + RoundToNearest(19999.99));
        //package.width = package.depth = package.height = 50;
        //var itemCube = RoundToNearest(parseFloat((package.width * package.depth * package.height) / 12));
        //console.log(itemCube);
        //itemCube = ToFixed(RoundToNearest(itemCube), 4);
        //console.log(itemCube);


        // All editable inputs will recalculated Imperial to Metric or vice versa on their respective pair.
        // And recalculates the cube.
        // TODO: redraw the canvas -> or resave an image and reload page to show the change.
        $('.cell').on('change', function () {
            console.log("DEBUG: Inside onchange.");

            // Detects which input is changed and updates the respective object values.
            switch (this.name) {
                // PACKAGE : IMPERIAL
                //case 'pkgW_CM', 'pkgD_CM', 'pkgH_CM':
                    //subConvertCMtoIN();
                case 'pkgW_CM': 
                    package_CM.width = $('#pkgW_CM').val();
                    break;
                case 'pkgD_CM':
                    package_CM.depth = $('#pkgD_CM').val();
                    break;
                case 'pkgH_CM':
                    package_CM.height = $('#pkgH_CM').val();
                    break;

                // PACKAGE : METRIC


                // MASTER CASE : IMPERIAL
                //case 'masterW_IN', 'masterD_CM', 'masterH_CM':
                    //subConvertINtoCM();
                case 'masterW_IN':
                    mCase_CM.width = $('#masterW_IN').val();
                    break;
                case 'masterD_CM':
                    mCase_CM.depth = $('#masterD_CM').val();
                    break;
                case 'masterH_CM':
                    mCase_CM.height = $('#masterH_CM').val();

                // MASTER CASE : IMPERIAL


                default:
                    break;
            }

            // Recalculates the cube when the inputs gets changed.
            if (package_CM.width != 0 && package_CM.depth != 0 && package_CM.height != 0) {
                var itemCube = RoundToNearest(parseFloat((package_CM.width * package_CM.depth * package_CM.height) / 1000000));
                // Extra: Round to 4 places max, but if only necessary:
                // original: Math.round(num * 100) / 100;
                // itemCube = Math.round((itemCube + 0.00001) * 10000) / 10000
                itemCube = RoundToNearest(itemCube).toFixed(4);
                document.getElementById('pkgC_M').value = itemCube;
                package_CM.cube = itemCube;
            }


            function prepareQtyCover() {
                cover.style.display = "inline";
                hide.style.display = "none";
            }
            // Magic stuff where when the qty input is clicked, it switch to a split input form
            // that display x * y value that equals the qty
            // It is 6(2*3) by default
            // TODO: smart calculation determine which config formation is optimal (via smaller cubic value?)
            function setQtyBy() {
                var cover = document.getElementById('qtyByCover');
                var hide = document.getElementById('qtyByHidden');

                if (cover.style.display=="inline" && hide.style.display=="none") {
                    cover.style.display = "none";
                    hide.style.display = "inline";
                }
                else if (cover.style.display == "none" && hide.style.display == "inline") {
                    cover.style.display = "inline";
                    hide.style.display = "none";
                }
            };

        });


        // Modifier buttons: click to switch between i) +1.5, +1.5, +2; ii) +2, +2, +2.5
        // TODO: A second button let user enters other vales (use pop-up window?)
        //var modValues = [1.5, 2, 2.5];
        //var modOpt = document.getElementById('modOpt');
        //var flag = 1;

        //ele = document.createElement('div');
        //ele.innerHTML = modValues[flag];
        //modOpt.appendChild(ele);
        //ele = document.createElement('div');
        //ele.innerHTML = modValues[flag];
        //modOpt.appendChild(ele);
        //ele = document.createElement('div');
        //ele.innerHTML = modValues[flag + 1];
        //modOpt.appendChild(ele);

        //ele = document.createElement('button');
        //ele.setAttribute('name', 'modBtn');
        //ele.setAttribute('id', 'modBtn');
        //ele.setAttribute('class', 'gemmyBorder');
        //ele.setAttribute('onclick', function () {
        //    flag = 1 - flag;
        //});
        //modOpt.appendChild(ele);
        
        //ele = 0; // clear ele
        
        (function () {
            if (pkgCanvas.getContext && caseCanvas.getContext) {

                //setInterval(render, 30);

            }
            else { alert('Cannot get canvas context'); }

        })();

        var angle = 75;
        function render() {
            var t = [];

            pkgContext.clearRect(0, 0, pkgCanvas.width, pkgCanvas.height);
            //caseContext.clearRect(0, 0, caseCanvas.width, caseCanvas.height);

            for (var i = 0; i < axis_vertices.length; i++) {
                var v = axis_vertices[i];
                var r = v.rotateX(angle).rotateY(angle).rotateZ(angle);
                // What I set below is origin to center of the canvas
                // which for some reason it is not in the center.
                var p = r.project(w, h, 128, 3.5);
                t.push(p);
            }

            c.save();
            //c.translate(-w / 2 + 50, h / 2 + 50);
            // Origin point for reference
            drawPoint(c, t[0].x, t[0].y, 5, "white");

            // for each axis: which are 3 of them
            drawLine(c, t[0], t[1], 1, red);
            drawLine(c, t[0], t[2], 1, green);
            drawLine(c, t[0], t[3], 1, blue);
            c.restore();
            angle += 2;
        }


        //$('#saveAsExcelBtn').on('click', function () {
        //    alert("Excel");
        //});

        // I dunno man, too hard?
        //$('#saveScreenBtn').on('click', function () {
        //    alert('Screenshot');
        //});

    </script>

</body>
</html>